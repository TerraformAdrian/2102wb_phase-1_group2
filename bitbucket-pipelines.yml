# TERRAFORM
#  www.TerraformCorp.com
#
# Sample Documentation
# https://support.atlassian.com/bitbucket-cloud/docs/deploy-to-aws-with-elastic-beanstalk/
# 

image: atlassian/default-image:2

pipelines:
  default:
    - step:
        name: "Zip Only"
        script:
          - echo "Zip Only"
          - ls -la
          - zip -r demo-nft-sportscast-net.zip * .[^.]*       
        
        # Define an artifact to pass the zip file to the next step
        artifacts: 
          - demo-nft-sportscast-net.zip
    - step:
        name: "Deploy to demo-nft-sportscast-net"
        # Track staging environments builds using deployments.
        deployment: production
        script:
        - echo "Deploy to demo-nft-sportscast-net"
        - pipe: atlassian/aws-elasticbeanstalk-deploy:0.5.0
          variables:
            DEBUG: 'TRUE'
            # upload-only is upload to S3 only, but dont deploy to beanstalk
            # COMMAND: 'upload-only'
            AWS_ACCESS_KEY_ID: $AWS_KEYID__demo_nft
            AWS_SECRET_ACCESS_KEY: $AWS_KEYSECRET__demo_nft
            AWS_DEFAULT_REGION: 'us-west-2'
            APPLICATION_NAME: 'demo.nft.sportscast.net'
            ENVIRONMENT_NAME: 'Demonftsportscastnet-env'
            ZIP_FILE: 'demo-nft-sportscast-net.zip'
            S3_BUCKET: 'elasticbeanstalk-us-west-2-461953590500'
            VERSION_LABEL: '_$(date +%Y-%m-%d_%H:%M:%S)_${BITBUCKET_COMMIT:0:8}'